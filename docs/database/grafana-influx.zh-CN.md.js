webpackJsonp([50],{1288:function(n,s){n.exports={content:["article",["h3","Install Influx DB"],["p","\u5728osx\u4e0b\u5b89\u88c5influxdb\u53ea\u9700\u6267\u884c"],["pre",{lang:null,highlighted:'brew update\nbrew install influxdb   # <span class="token keyword">for</span> version <span class="token number">1</span><span class="token punctuation">,</span> brew install influxdb<span class="token variable">@1</span>'},["code","brew update\nbrew install influxdb   # for version 1, brew install influxdb@1"]],["p","\u4e5f\u53ef\u4ee5\u901a\u8fc7\u89e3\u538b\u5305\u5b89\u88c5"],["pre",{lang:null,highlighted:'wget https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>dl<span class="token punctuation">.</span>influxdata<span class="token punctuation">.</span>com<span class="token operator">/</span>influxdb<span class="token operator">/</span>releases<span class="token operator">/</span>influxdb2<span class="token operator">-</span><span class="token number">2.0</span><span class="token punctuation">.</span><span class="token number">6</span><span class="token operator">-</span>darwin<span class="token operator">-</span>amd64<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz'},["code","wget https://dl.influxdata.com/influxdb/releases/influxdb2-2.0.6-darwin-amd64.tar.gz"]],["p","\u5b89\u88c5\u597d\u4e4b\u540e\u5728\u547d\u4ee4\u884c\u4e2d\u6267\u884c\u5373\u53ef\u542f\u52a8influxdb\uff0c \u5e76\u53ef\u4ee5\u901a\u8fc7",["a",{title:null,href:"http://localhost:8086/"},"http://localhost:8086/"]," web ui \u5bf9influxdb \u8fdb\u884c\u7ba1\u7406\u7ef4\u62a4"],["pre",{lang:null,highlighted:"influxd"},["code","influxd"]],["p","\u57fa\u672c\u547d\u4ee4"],["pre",{lang:null,highlighted:'<span class="token operator">+</span> \u521b\u5efabuckets'},["code","+ \u521b\u5efabuckets"]],["p","jetmac:~ jet$ influx bucket create -n nginx-bucket -o jetqin -t your-admin-token\nID\t\t\tName\t\tRetention\tShard group duration\tOrganization ID\n79a3091950f82a3c\tnginx-bucket\tinfinite\t168h0m0s\t\t2a9a53d1f1d2fff4"],["pre",{lang:null,highlighted:'<span class="token operator">+</span> \u67e5\u770bbuckets'},["code","+ \u67e5\u770bbuckets"]],["p","jetmac:~ jet$ influx bucket list -o jetqin -t your-admin-token\nID\t\t\tName\t\tRetention\tShard group duration\tOrganization ID\n79a3091950f82a3c\tnginx-bucket\t720h0m0s\t24h0m0s\t\t\t2a9a53d1f1d2fff4"],["h3","Install Telegraf"],["p","\u5728osx\u4e0b\u5b89\u88c5telegraf\u53ea\u9700\u6267\u884c"],["pre",{lang:null,highlighted:"brew update\nbrew install telegraf "},["code","brew update\nbrew install telegraf "]],["ul",["li",["p","\u4fee\u6539\u9ed8\u8ba4\u7684\u914d\u7f6e\u6587\u4ef6 /usr/local/etc/telegraf.conf"]]],["pre",{lang:null,highlighted:'# Configuration <span class="token keyword">for</span> telegraf agent\n<span class="token punctuation">[</span>agent<span class="token punctuation">]</span>\n  interval <span class="token operator">=</span> <span class="token string">"10s"</span>\n  round_interval <span class="token operator">=</span> <span class="token boolean">true</span>\n  metric_batch_size <span class="token operator">=</span> <span class="token number">1000</span>\n  metric_buffer_limit <span class="token operator">=</span> <span class="token number">10000</span>\n  collection_jitter <span class="token operator">=</span> <span class="token string">"0s"</span>\n  flush_interval <span class="token operator">=</span> <span class="token string">"10s"</span>\n  flush_jitter <span class="token operator">=</span> <span class="token string">"0s"</span>\n  precision <span class="token operator">=</span> <span class="token string">""</span>\n\n<span class="token punctuation">[</span><span class="token punctuation">[</span>outputs<span class="token punctuation">.</span>influxdb_v2<span class="token punctuation">]</span><span class="token punctuation">]</span>\n  urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"http://127.0.0.1:8086"</span><span class="token punctuation">]</span>\n\n  ## Token <span class="token keyword">for</span> authentication<span class="token punctuation">.</span>\n  token <span class="token operator">=</span> <span class="token string">"XXXXXXXX"</span>\n\n  ## Organization is the name of the organization you wish <span class="token keyword">to</span> write <span class="token keyword">to</span><span class="token comment" spellcheck="true">; must exist.</span>\n  organization <span class="token operator">=</span> <span class="token string">"jetqin"</span>\n\n  ## Destination bucket <span class="token keyword">to</span> write into<span class="token punctuation">.</span>\n  bucket <span class="token operator">=</span> <span class="token string">"nginx-bucket"</span>\n\n  ## The value of this tag will be used <span class="token keyword">to</span> determine the bucket<span class="token punctuation">.</span>  <span class="token keyword">If</span> this\n  ## tag is <span class="token operator">not</span> set the <span class="token string">\'bucket\'</span> option is used as the <span class="token keyword">default</span><span class="token punctuation">.</span>\n  bucket_tag <span class="token operator">=</span> <span class="token string">"nginx"</span>\n\n<span class="token punctuation">[</span><span class="token punctuation">[</span>inputs<span class="token punctuation">.</span>nginx<span class="token punctuation">]</span><span class="token punctuation">]</span>\n  # An array of Nginx stub_status URI <span class="token keyword">to</span> gather stats<span class="token punctuation">.</span>\n  urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"https://jetqin.io:8443/nginx_status"</span><span class="token punctuation">]</span>\n\n  ## Optional TLS Config\n  tls_ca <span class="token operator">=</span> <span class="token string">"/usr/local/etc/nginx/ca.crt"</span>\n  tls_cert <span class="token operator">=</span> <span class="token string">"/usr/local/etc/nginx/ca.crt"</span>\n  tls_key <span class="token operator">=</span> <span class="token string">"/usr/local/etc/nginx/ca.key"</span>\n  ## Use TLS but skip chain <span class="token operator">&amp;</span> host verification\n  insecure_skip_verify <span class="token operator">=</span> <span class="token boolean">false</span>\n\n  # HTTP response timeout <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">:</span> 5s<span class="token punctuation">)</span>\n  response_timeout <span class="token operator">=</span> <span class="token string">"5s"</span>'},["code",'# Configuration for telegraf agent\n[agent]\n  interval = "10s"\n  round_interval = true\n  metric_batch_size = 1000\n  metric_buffer_limit = 10000\n  collection_jitter = "0s"\n  flush_interval = "10s"\n  flush_jitter = "0s"\n  precision = ""\n\n[[outputs.influxdb_v2]]\n  urls = ["http://127.0.0.1:8086"]\n\n  ## Token for authentication.\n  token = "XXXXXXXX"\n\n  ## Organization is the name of the organization you wish to write to; must exist.\n  organization = "jetqin"\n\n  ## Destination bucket to write into.\n  bucket = "nginx-bucket"\n\n  ## The value of this tag will be used to determine the bucket.  If this\n  ## tag is not set the \'bucket\' option is used as the default.\n  bucket_tag = "nginx"\n\n[[inputs.nginx]]\n  # An array of Nginx stub_status URI to gather stats.\n  urls = ["https://jetqin.io:8443/nginx_status"]\n\n  ## Optional TLS Config\n  tls_ca = "/usr/local/etc/nginx/ca.crt"\n  tls_cert = "/usr/local/etc/nginx/ca.crt"\n  tls_key = "/usr/local/etc/nginx/ca.key"\n  ## Use TLS but skip chain & host verification\n  insecure_skip_verify = false\n\n  # HTTP response timeout (default: 5s)\n  response_timeout = "5s"']],["ul",["li",["p","\u542f\u52a8Telegraf \u670d\u52a1"]]],["pre",{lang:null,highlighted:'jetmac<span class="token punctuation">:</span>~ jet$ brew services restart telegraf\nStopping `telegraf`<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">(</span>might take a <span class="token keyword">while</span><span class="token punctuation">)</span>\n<span class="token operator">==</span><span class="token operator">></span> Successfully stopped `telegraf` <span class="token punctuation">(</span>label<span class="token punctuation">:</span> homebrew<span class="token punctuation">.</span>mxcl<span class="token punctuation">.</span>telegraf<span class="token punctuation">)</span>\n<span class="token operator">==</span><span class="token operator">></span> Successfully started `telegraf` <span class="token punctuation">(</span>label<span class="token punctuation">:</span> homebrew<span class="token punctuation">.</span>mxcl<span class="token punctuation">.</span>telegraf<span class="token punctuation">)</span>'},["code","jetmac:~ jet$ brew services restart telegraf\nStopping `telegraf`... (might take a while)\n==> Successfully stopped `telegraf` (label: homebrew.mxcl.telegraf)\n==> Successfully started `telegraf` (label: homebrew.mxcl.telegraf)"]],["h3","\u751f\u6210\u8bc1\u4e66"],["p","telegraf \u5199\u4e66\u65f6\u8981\u6c42\u8bc1\u4e66\u5fc5\u987b\u662f\u652f\u6301SAN\u7684\uff0c\u6240\u4ee5\u751f\u6210san\u8bc1\u4e66"],["ul",["li",["p","\u521b\u5efa\u8bc1\u4e66\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6"]]],["pre",{lang:null,highlighted:'<span class="token punctuation">[</span> req <span class="token punctuation">]</span>\ndefault_bits <span class="token operator">=</span> <span class="token number">2048</span>\nprompt <span class="token operator">=</span> no\ndefault_md <span class="token operator">=</span> sha256\n<span class="token directive keyword">#req_extensions</span> <span class="token operator">=</span> req_ext\nx509_extensions <span class="token operator">=</span> v3_req\ndistinguished_name <span class="token operator">=</span> dn\n\n<span class="token punctuation">[</span> dn <span class="token punctuation">]</span>\nC <span class="token operator">=</span> UK\nST <span class="token operator">=</span> London\nL <span class="token operator">=</span> London\nO <span class="token operator">=</span> JetTech Ltd<span class="token punctuation">.</span>\nOU <span class="token operator">=</span> JET Technologies\nemailAddress <span class="token operator">=</span> qinjet<span class="token variable">@live</span><span class="token punctuation">.</span>cn\nCN <span class="token operator">=</span> jetqin<span class="token punctuation">.</span>io\n\n<span class="token punctuation">[</span>ca<span class="token punctuation">]</span>\ndefault_ca    <span class="token operator">=</span> my_ca_default\n\n# <span class="token punctuation">[</span>req_ext<span class="token punctuation">]</span>\n# subjectAltName <span class="token operator">=</span> <span class="token variable">@alt_names</span>\n\n<span class="token punctuation">[</span>v3_req<span class="token punctuation">]</span>\nsubjectAltName <span class="token operator">=</span> <span class="token variable">@alt_names</span>\n\n<span class="token punctuation">[</span> alt_names <span class="token punctuation">]</span>\nDNS<span class="token punctuation">.</span><span class="token number">1</span> <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">.</span>jetqin<span class="token punctuation">.</span>io\nDNS<span class="token punctuation">.</span><span class="token number">2</span> <span class="token operator">=</span> jetqin<span class="token punctuation">.</span>io\nDNS<span class="token punctuation">.</span><span class="token number">3</span> <span class="token operator">=</span> www<span class="token punctuation">.</span>jetqin<span class="token punctuation">.</span>io\nDNS<span class="token punctuation">.</span><span class="token number">4</span> <span class="token operator">=</span> localhost'},["code","[ req ]\ndefault_bits = 2048\nprompt = no\ndefault_md = sha256\n#req_extensions = req_ext\nx509_extensions = v3_req\ndistinguished_name = dn\n\n[ dn ]\nC = UK\nST = London\nL = London\nO = JetTech Ltd.\nOU = JET Technologies\nemailAddress = qinjet@live.cn\nCN = jetqin.io\n\n[ca]\ndefault_ca    = my_ca_default\n\n# [req_ext]\n# subjectAltName = @alt_names\n\n[v3_req]\nsubjectAltName = @alt_names\n\n[ alt_names ]\nDNS.1 = *.jetqin.io\nDNS.2 = jetqin.io\nDNS.3 = www.jetqin.io\nDNS.4 = localhost"]],["ul",["li",["p","\u6839\u636e\u9ed8\u8ba4\u7684\u914d\u7f6e\u6587\u4ef6\u521b\u5efa\u8bc1\u4e66"]]],["pre",{lang:null,highlighted:'openssl req <span class="token operator">-</span>new <span class="token operator">-</span>x509 <span class="token operator">-</span>newkey rsa<span class="token punctuation">:</span><span class="token number">2048</span> <span class="token operator">-</span>sha256 <span class="token operator">-</span>nodes <span class="token operator">-</span>keyout ca<span class="token punctuation">.</span>key <span class="token operator">-</span>days <span class="token number">3560</span> <span class="token operator">-</span>out ca<span class="token punctuation">.</span>crt <span class="token operator">-</span>config cert<span class="token punctuation">.</span>conf'},["code","openssl req -new -x509 -newkey rsa:2048 -sha256 -nodes -keyout ca.key -days 3560 -out ca.crt -config cert.conf"]],["p","\u53ef\u4ee5\u770b\u5230\u540c\u4e00\u4e2a\u8bc1\u4e66\u53ef\u4ee5\u652f\u6301\u591a\u4e2a\u57df\u540d\n",["img",{title:null,src:"./assets/san-cert.png",alt:"SAN Cert"}]],["h3","\u5199\u5165InFlux"],["p","\u914d\u7f6e\u597d\u4ee5\u4e0a\u6b65\u9aa4\uff0c\u5c31\u53ef\u4ee5\u5728inlfux web ui \u4e2d\u67e5\u770b telegraf\u6536\u96c6\u5230\u7684nginx\u65e5\u5fd7\u4fe1\u606f"],["p",["img",{title:null,src:"./assets/influxdb.png",alt:"Influx DB dashboard"}]],["h3","\u76d1\u63a7"],["ul",["li",["p","\u914d\u7f6eGrafana"]]],["p",["img",{title:null,src:"./assets/grafana-influx.png",alt:"Grafana Influx Datasource config"}]],["ul",["li",["p","\u521b\u5efaNginx Dashboard"]]],["p","\u901a\u8fc7flux\u67e5\u8be2\u8fd4\u56de\u65f6\u8bb8\u7ed3\u679c\u96c6"],["pre",{lang:null,highlighted:'<span class="token function">from</span><span class="token punctuation">(</span>bucket<span class="token punctuation">:</span> <span class="token string">"nginx-bucket"</span><span class="token punctuation">)</span>\n  |<span class="token operator">></span> <span class="token function">range</span><span class="token punctuation">(</span>start<span class="token punctuation">:</span> v<span class="token punctuation">.</span>timeRangeStart<span class="token punctuation">,</span> stop<span class="token punctuation">:</span> v<span class="token punctuation">.</span>timeRangeStop<span class="token punctuation">)</span>\n  |<span class="token operator">></span> <span class="token function">filter</span><span class="token punctuation">(</span>fn<span class="token punctuation">:</span> <span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> r<span class="token punctuation">.</span>_field <span class="token operator">==</span> <span class="token string">"accepts"</span> <span class="token operator">or</span> r<span class="token punctuation">.</span>_field <span class="token operator">==</span> <span class="token string">"active"</span> <span class="token operator">or</span> r<span class="token punctuation">.</span>_field <span class="token operator">==</span> <span class="token string">"handled"</span> <span class="token operator">or</span> r<span class="token punctuation">.</span>_field <span class="token operator">==</span> <span class="token string">"reading"</span> <span class="token operator">or</span> r<span class="token punctuation">.</span>_field <span class="token operator">==</span> <span class="token string">"waiting"</span> <span class="token operator">or</span> r<span class="token punctuation">.</span>_field <span class="token operator">==</span> <span class="token string">"writing"</span><span class="token punctuation">)</span>\n  |<span class="token operator">></span> <span class="token function">filter</span><span class="token punctuation">(</span>fn<span class="token punctuation">:</span> <span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> r<span class="token punctuation">.</span>host <span class="token operator">==</span> <span class="token string">"jetmac.local"</span><span class="token punctuation">)</span>'},["code",'from(bucket: "nginx-bucket")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._field == "accepts" or r._field == "active" or r._field == "handled" or r._field == "reading" or r._field == "waiting" or r._field == "writing")\n  |> filter(fn: (r) => r.host == "jetmac.local")']],["p",["img",{title:null,src:"./assets/grafana-dashboard.png",alt:"Grafana dashboard"}]]],meta:{order:52,title:"\u901a\u8fc7Grafana Influx\u76d1\u63a7Nginx",type:"\u5165\u95e8",filename:"docs/database/grafana-influx.zh-CN.md"},toc:["ul"]}}});